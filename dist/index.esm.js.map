{"version":3,"file":"index.esm.js","sources":["../src/index.js"],"sourcesContent":["/**\n * A Named Promise Task \n * Inspire from https://stackoverflow.com/questions/53540348/js-async-await-tasks-queue\n */\nimport { EventEmitter } from 'events'\n\nclass PromiseTask extends EventEmitter {\n  constructor ( context, namedWorkers ) {\n    super()\n    this._context = context\n    this._namedWorkers = namedWorkers\n    this._pending = Promise.resolve();\n    this._size = 0\n  }\n\n  // task queue size\n  get size() {\n    return this._size\n  }\n\n  // checking is running\n  get isRunning() {\n    return this._size !== 0\n  }\n\n  // task executor\n  addTask = ( () => {\n    let pending = Promise.resolve();\n\n    const run = async ( name, ...values ) => {\n      try {\n        await pending;\n      } finally {\n        return this._namedWorkers[ name ].call(this._context, ...values ).finally(()=>{\n          this._size--\n          if(this._size===0) {\n            this.emit('stop')\n          }\n        });\n      }\n    }\n\n    // update pending promise so that next task could await for it\n    return ( name, ...values ) => {\n      this._size++\n      if(this._size===1) {\n        this.emit('start')\n      }\n      return ( pending = run( name, ...values ) )\n    }\n  } )()\n}\n\nexport default PromiseTask\n"],"names":["PromiseTask","EventEmitter","constructor","context","namedWorkers","pending","Promise","resolve","run","name","values","_namedWorkers","call","_context","finally","_size","emit","_pending","size","isRunning"],"mappings":";;;;;;AAAA;;;;;AAMA,MAAMA,WAAN,SAA0BC,YAA1B,CAAuC;AACrCC,EAAAA,WAAW,CAAGC,OAAH,EAAYC,YAAZ,EAA2B;AAAA;;AACpC,WADoC;AAAA;;AAAA,qCAmB5B,CAAE,MAAM;AAChB,UAAIC,OAAO,GAAGC,OAAO,CAACC,OAAR,EAAd;;AAEA,YAAMC,GAAG,GAAG,eAANA,GAAM,CAAQC,IAAR,EAA6B;AACvC,YAAI;AACF,gBAAMJ,OAAN;AACD,SAFD,SAEU;AAAA,4CAHiBK,MAGjB;AAHiBA,YAAAA,MAGjB;AAAA;;AACR,iBAAO,KAAI,CAACC,aAAL,CAAoBF,IAApB,EAA2BG,IAA3B,CAAgC,KAAI,CAACC,QAArC,EAA+C,GAAGH,MAAlD,EAA2DI,OAA3D,CAAmE,MAAI;AAC5E,YAAA,KAAI,CAACC,KAAL;;AACA,gBAAG,KAAI,CAACA,KAAL,KAAa,CAAhB,EAAmB;AACjB,cAAA,KAAI,CAACC,IAAL,CAAU,MAAV;AACD;AACF,WALM,CAAP;AAMD;OAVH,CAHgB;;;AAiBhB,aAAO,UAAEP,IAAF,EAAuB;AAC5B,QAAA,KAAI,CAACM,KAAL;;AACA,YAAG,KAAI,CAACA,KAAL,KAAa,CAAhB,EAAmB;AACjB,UAAA,KAAI,CAACC,IAAL,CAAU,OAAV;AACD;;AAJ2B,2CAAZN,MAAY;AAAZA,UAAAA,MAAY;AAAA;;AAK5B,eAASL,OAAO,GAAGG,GAAG,CAAEC,IAAF,EAAQ,GAAGC,MAAX,CAAtB;AACD,OAND;AAOD,KAxBS,GAnB4B;;AAEpC,SAAKG,QAAL,GAAgBV,OAAhB;AACA,SAAKQ,aAAL,GAAqBP,YAArB;AACA,SAAKa,QAAL,GAAgBX,OAAO,CAACC,OAAR,EAAhB;AACA,SAAKQ,KAAL,GAAa,CAAb;AACD,GAPoC;;;AAUrC,MAAIG,IAAJ,GAAW;AACT,WAAO,KAAKH,KAAZ;AACD,GAZoC;;;AAerC,MAAII,SAAJ,GAAgB;AACd,WAAO,KAAKJ,KAAL,KAAe,CAAtB;AACD,GAjBoC;;;AAAA;;"}