{"version":3,"file":"index.esm.js","sources":["../src/index.js"],"sourcesContent":["/**\n * A Named Promise Task\n * Inspire from https://stackoverflow.com/questions/53540348/js-async-await-tasks-queue\n */\nimport { EventEmitter } from 'events'\n\nclass PromiseTask extends EventEmitter {\n  constructor (context, namedWorkers) {\n    super()\n    this._context = context\n    this._namedWorkers = namedWorkers\n    this._pending = Promise.resolve()\n    this._size = 0\n  }\n\n  // task queue size\n  get size () {\n    return this._size\n  }\n\n  // checking is running\n  get isRunning () {\n    return this._size !== 0\n  }\n\n  // task executor\n  addTask = (() => {\n    let pending = Promise.resolve()\n\n    const run = async (name, ...values) => {\n      try {\n        await pending\n      } finally {\n        return this._namedWorkers[name].call(this._context, ...values).finally(() => {\n          this._size--\n          if (this._size === 0) {\n            this.emit('stop')\n          }\n        })\n      }\n    }\n\n    // update pending promise so that next task could await for it\n    return (name, ...values) => {\n      this._size++\n      if (this._size === 1) {\n        this.emit('start')\n      }\n      return (pending = run(name, ...values))\n    }\n  })()\n}\n\nexport default PromiseTask\n"],"names":[],"mappings":";;AAAA;AACA;AACA;AACA;AAEA;AACA,MAAM,WAAW,SAAS,YAAY,CAAC;AACvC,EAAE,WAAW,CAAC,CAAC,OAAO,EAAE,YAAY,EAAE;AACtC,IAAI,KAAK,GAAE;AACX,IAAI,IAAI,CAAC,QAAQ,GAAG,QAAO;AAC3B,IAAI,IAAI,CAAC,aAAa,GAAG,aAAY;AACrC,IAAI,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,OAAO,GAAE;AACrC,IAAI,IAAI,CAAC,KAAK,GAAG,EAAC;AAClB,GAAG;AACH;AACA;AACA,EAAE,IAAI,IAAI,CAAC,GAAG;AACd,IAAI,OAAO,IAAI,CAAC,KAAK;AACrB,GAAG;AACH;AACA;AACA,EAAE,IAAI,SAAS,CAAC,GAAG;AACnB,IAAI,OAAO,IAAI,CAAC,KAAK,KAAK,CAAC;AAC3B,GAAG;AACH;AACA;AACA,EAAE,OAAO,GAAG,CAAC,MAAM;AACnB,IAAI,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,GAAE;AACnC;AACA,IAAI,MAAM,GAAG,GAAG,OAAO,IAAI,EAAE,GAAG,MAAM,KAAK;AAC3C,MAAM,IAAI;AACV,QAAQ,MAAM,QAAO;AACrB,OAAO,SAAS;AAChB,QAAQ,OAAO,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,GAAG,MAAM,CAAC,CAAC,OAAO,CAAC,MAAM;AACrF,UAAU,IAAI,CAAC,KAAK,GAAE;AACtB,UAAU,IAAI,IAAI,CAAC,KAAK,KAAK,CAAC,EAAE;AAChC,YAAY,IAAI,CAAC,IAAI,CAAC,MAAM,EAAC;AAC7B,WAAW;AACX,SAAS,CAAC;AACV,OAAO;AACP,MAAK;AACL;AACA;AACA,IAAI,OAAO,CAAC,IAAI,EAAE,GAAG,MAAM,KAAK;AAChC,MAAM,IAAI,CAAC,KAAK,GAAE;AAClB,MAAM,IAAI,IAAI,CAAC,KAAK,KAAK,CAAC,EAAE;AAC5B,QAAQ,IAAI,CAAC,IAAI,CAAC,OAAO,EAAC;AAC1B,OAAO;AACP,MAAM,QAAQ,OAAO,GAAG,GAAG,CAAC,IAAI,EAAE,GAAG,MAAM,CAAC,CAAC;AAC7C,KAAK;AACL,GAAG,GAAG;AACN;;;;"}