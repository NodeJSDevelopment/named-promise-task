{"version":3,"file":"index.cjs.js","sources":["../src/index.js"],"sourcesContent":["/**\n * A Named Promise Task \n * Inspire from https://stackoverflow.com/questions/53540348/js-async-await-tasks-queue\n */\nimport { EventEmitter } from 'events'\nimport { Promise } from 'bluebird'\n\nclass PromiseTask extends EventEmitter {\n  constructor ( context, namedWorkers ) {\n    super()\n    this._context = context\n    this._namedWorkers = namedWorkers\n    this._pending = Promise.resolve();\n    this._size = 0\n  }\n\n  // task queue size\n  get size() {\n    return this._size\n  }\n\n  // checking is running\n  get isRunning() {\n    return this._size !== 0\n  }\n\n  // task executor\n  addTask = ( () => {\n    let pending = Promise.resolve();\n\n    const run = async ( name, ...values ) => {\n      try {\n        await pending;\n      } finally {\n        return this._namedWorkers[ name ].call(this._context, ...values ).finally(()=>{\n          this._size--\n          if(this._size===0) {\n            this.emit('stop')\n          }\n        });\n      }\n    }\n\n    // update pending promise so that next task could await for it\n    return ( name, ...values ) => {\n      this._size++\n      if(this._size===1) {\n        this.emit('start')\n      }\n      return ( pending = run( name, ...values ) )\n    }\n  } )()\n}\n\nexport default PromiseTask\n"],"names":["PromiseTask","context","namedWorkers","pending","Promise","resolve","run","name","values","_namedWorkers","call","_context","_size","emit","_pending","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;IAOMA;;;;;AACJ,uBAAcC,OAAd,EAAuBC,YAAvB,EAAsC;AAAA;;AAAA;;AACpC;;AADoC,8DAmB1B,YAAM;AAChB,UAAIC,OAAO,GAAGC,gBAAAA,CAAQC,OAARD,EAAd;;AAEA,UAAME,GAAG;AAAA,4EAAG,iBAAQC,IAAR;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAEFJ,OAFE;;AAAA;AAAA;;AAAA,4CAAiBK,MAAjB;AAAiBA,oBAAAA,MAAjB;AAAA;;AAAA,mDAID,+BAAKC,aAAL,CAAoBF,IAApB,GAA2BG,IAA3B,+BAAgC,MAAKC,QAArC,SAAkDH,MAAlD,cAAmE,YAAI;AAC5E,0BAAKI,KAAL;;AACA,wBAAG,MAAKA,KAAL,KAAa,CAAhB,EAAmB;AACjB,4BAAKC,IAAL,CAAU,MAAV;AACD;AACF,mBALM,CAJC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAH;;AAAA,wBAAHP,GAAG;AAAA;AAAA;AAAA,SAAT,CAHgB;;;AAiBhB,aAAO,UAAEC,IAAF,EAAuB;AAC5B,cAAKK,KAAL;;AACA,YAAG,MAAKA,KAAL,KAAa,CAAhB,EAAmB;AACjB,gBAAKC,IAAL,CAAU,OAAV;AACD;;AAJ2B,2CAAZL,MAAY;AAAZA,UAAAA,MAAY;AAAA;;AAK5B,eAASL,OAAO,GAAGG,GAAG,MAAH,UAAKC,IAAL,SAAcC,MAAd,EAAnB;AACD,OAND;AAOD,KAxBS,EAnB4B;;AAEpC,UAAKG,QAAL,GAAgBV,OAAhB;AACA,UAAKQ,aAAL,GAAqBP,YAArB;AACA,UAAKY,QAAL,GAAgBV,gBAAAA,CAAQC,OAARD,EAAhB;AACA,UAAKQ,KAAL,GAAa,CAAb;AALoC;AAMrC;;;;;wBAGU;AACT,aAAO,KAAKA,KAAZ;AACD;;;;wBAGe;AACd,aAAO,KAAKA,KAAL,KAAe,CAAtB;AACD;;;;;EAjBuBG;;"}