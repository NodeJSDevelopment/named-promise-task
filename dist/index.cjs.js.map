{"version":3,"file":"index.cjs.js","sources":["../src/index.js"],"sourcesContent":["/**\n * A Named Promise Task\n * Inspire from https://stackoverflow.com/questions/53540348/js-async-await-tasks-queue\n */\nimport { EventEmitter } from 'events'\n\nclass PromiseTask extends EventEmitter {\n  constructor (context, namedWorkers) {\n    super()\n    this._context = context\n    this._namedWorkers = namedWorkers\n    this._pending = Promise.resolve()\n    this._size = 0\n  }\n\n  // task queue size\n  get size () {\n    return this._size\n  }\n\n  // checking is running\n  get isRunning () {\n    return this._size !== 0\n  }\n\n  // task executor\n  addTask = (() => {\n    let pending = Promise.resolve()\n\n    const run = async (name, ...values) => {\n      try {\n        await pending\n      } finally {\n        return Promise.resolve(this._namedWorkers[name].call(this._context, ...values)).finally(() => {\n          this._size--\n          if (this._size === 0) {\n            this.emit('stop')\n          }\n        })\n      }\n    }\n\n    // update pending promise so that next task could await for it\n    return (name, ...values) => {\n      this._size++\n      if (this._size === 1) {\n        this.emit('start')\n      }\n      return (pending = run(name, ...values))\n    }\n  })()\n}\n\nexport default PromiseTask\n"],"names":["PromiseTask","EventEmitter","constructor","context","namedWorkers","pending","Promise","resolve","run","name","values","_namedWorkers","call","_context","finally","_size","emit","_pending","size","isRunning"],"mappings":";;;;;;;;;;;;;AAAA;;;;;;AAMA,MAAMA,WAAN,SAA0BC,mBAA1B,CAAuC;AACrCC,EAAAA,WAAW,CAAEC,OAAF,EAAWC,YAAX,EAAyB;AAAA;;AAClC,WADkC;AAAA;;AAAA,qCAmB1B,CAAC,MAAM;AACf,UAAIC,OAAO,GAAGC,OAAO,CAACC,OAAR,EAAd;;AAEA,YAAMC,GAAG,GAAG,eAANA,GAAM,CAAOC,IAAP,EAA2B;AACrC,YAAI;AACF,gBAAMJ,OAAN;AACD,SAFD,SAEU;AAAA,4CAHgBK,MAGhB;AAHgBA,YAAAA,MAGhB;AAAA;;AACR,iBAAOJ,OAAO,CAACC,OAAR,CAAgB,KAAI,CAACI,aAAL,CAAmBF,IAAnB,EAAyBG,IAAzB,CAA8B,KAAI,CAACC,QAAnC,EAA6C,GAAGH,MAAhD,CAAhB,EAAyEI,OAAzE,CAAiF,MAAM;AAC5F,YAAA,KAAI,CAACC,KAAL;;AACA,gBAAI,KAAI,CAACA,KAAL,KAAe,CAAnB,EAAsB;AACpB,cAAA,KAAI,CAACC,IAAL,CAAU,MAAV;AACD;AACF,WALM,CAAP;AAMD;OAVH,CAHe;;;AAiBf,aAAO,UAACP,IAAD,EAAqB;AAC1B,QAAA,KAAI,CAACM,KAAL;;AACA,YAAI,KAAI,CAACA,KAAL,KAAe,CAAnB,EAAsB;AACpB,UAAA,KAAI,CAACC,IAAL,CAAU,OAAV;AACD;;AAJyB,2CAAXN,MAAW;AAAXA,UAAAA,MAAW;AAAA;;AAK1B,eAAQL,OAAO,GAAGG,GAAG,CAACC,IAAD,EAAO,GAAGC,MAAV,CAArB;AACD,OAND;AAOD,KAxBS,GAnB0B;;AAElC,SAAKG,QAAL,GAAgBV,OAAhB;AACA,SAAKQ,aAAL,GAAqBP,YAArB;AACA,SAAKa,QAAL,GAAgBX,OAAO,CAACC,OAAR,EAAhB;AACA,SAAKQ,KAAL,GAAa,CAAb;AACD,GAPoC;;;AAUrC,MAAIG,IAAJ,GAAY;AACV,WAAO,KAAKH,KAAZ;AACD,GAZoC;;;AAerC,MAAII,SAAJ,GAAiB;AACf,WAAO,KAAKJ,KAAL,KAAe,CAAtB;AACD,GAjBoC;;;AAAA;;"}