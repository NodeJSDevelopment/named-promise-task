{"version":3,"file":"index.cjs.js","sources":["../src/index.js"],"sourcesContent":["/**\n * A Named Promise Task\n * Inspire from https://stackoverflow.com/questions/53540348/js-async-await-tasks-queue\n */\nimport { EventEmitter } from 'events'\n\nclass PromiseTask extends EventEmitter {\n  constructor (context, namedWorkers) {\n    super()\n    this._context = context\n    this._namedWorkers = namedWorkers\n    this._pending = Promise.resolve()\n    this._size = 0\n  }\n\n  // task queue size\n  get size () {\n    return this._size\n  }\n\n  // checking is running\n  get isRunning () {\n    return this._size !== 0\n  }\n\n  // task executor\n  addTask = (() => {\n    let pending = Promise.resolve()\n\n    const run = async (name, ...values) => {\n      try {\n        await pending\n      } finally {\n        return Promise.resolve(this._namedWorkers[name].call(this._context, ...values)).finally(() => {\n          this._size--\n          if (this._size === 0) {\n            this.emit('stop')\n          }\n        })\n      }\n    }\n\n    // update pending promise so that next task could await for it\n    return (name, ...values) => {\n      this._size++\n      if (this._size === 1) {\n        this.emit('start')\n      }\n      return (pending = run(name, ...values))\n    }\n  })()\n}\n\nexport default PromiseTask\n"],"names":["PromiseTask","context","namedWorkers","pending","Promise","resolve","run","name","values","_namedWorkers","call","_context","_size","emit","_pending","EventEmitter"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;IAMMA;;;;;AACJ,uBAAaC,OAAb,EAAsBC,YAAtB,EAAoC;AAAA;;AAAA;;AAClC;;AADkC,8DAmBzB,YAAM;AACf,UAAIC,OAAO,GAAGC,OAAO,CAACC,OAAR,EAAd;;AAEA,UAAMC,GAAG;AAAA,4EAAG,iBAAOC,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAEFJ,OAFE;;AAAA;AAAA;;AAAA,4CAAgBK,MAAhB;AAAgBA,oBAAAA,MAAhB;AAAA;;AAAA,mDAIDJ,OAAO,CAACC,OAAR,CAAgB,+BAAKI,aAAL,CAAmBF,IAAnB,GAAyBG,IAAzB,+BAA8B,MAAKC,QAAnC,SAAgDH,MAAhD,EAAhB,aAAiF,YAAM;AAC5F,0BAAKI,KAAL;;AACA,wBAAI,MAAKA,KAAL,KAAe,CAAnB,EAAsB;AACpB,4BAAKC,IAAL,CAAU,MAAV;AACD;AACF,mBALM,CAJC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAH;;AAAA,wBAAHP,GAAG;AAAA;AAAA;AAAA,SAAT,CAHe;;;AAiBf,aAAO,UAACC,IAAD,EAAqB;AAC1B,cAAKK,KAAL;;AACA,YAAI,MAAKA,KAAL,KAAe,CAAnB,EAAsB;AACpB,gBAAKC,IAAL,CAAU,OAAV;AACD;;AAJyB,2CAAXL,MAAW;AAAXA,UAAAA,MAAW;AAAA;;AAK1B,eAAQL,OAAO,GAAGG,GAAG,MAAH,UAAIC,IAAJ,SAAaC,MAAb,EAAlB;AACD,OAND;AAOD,KAxBS,EAnB0B;;AAElC,UAAKG,QAAL,GAAgBV,OAAhB;AACA,UAAKQ,aAAL,GAAqBP,YAArB;AACA,UAAKY,QAAL,GAAgBV,OAAO,CAACC,OAAR,EAAhB;AACA,UAAKO,KAAL,GAAa,CAAb;AALkC;AAMnC;;;;;wBAGW;AACV,aAAO,KAAKA,KAAZ;AACD;;;;wBAGgB;AACf,aAAO,KAAKA,KAAL,KAAe,CAAtB;AACD;;;;;EAjBuBG;;"}